#!/usr/bin/env modbuild

pbuild::set_download_url "http://www.kernel.org/pub/software/scm/$P/$P-${V_PKG}.tar.gz"
pbuild::compile_in_sourcetree
pbuild::install_docfiles 'COPYING' 'README.md'

pbuild::pre_configure_Darwin() {
	export NO_APPLE_COMMON_CRYPTO=1
}

pbuild::post_configure_Linux() {
	echo 'LIBC_CONTAINS_LIBINTL=' >> "${SRC_DIR}/config.mak.autogen"
}

pbuild::pre_configure() {
	#pbuild::add_configure_args "LIBS=-lintl"
	pbuild::add_configure_args "--with-tcltk"
	pbuild::add_configure_args "--with-iconv=${GETTEXT_PREFIX}"
	pbuild::add_configure_args "--with-perl=${PERL_PREFIX}/bin/perl"
}

pbuild::post_compile() {
	make -C contrib/subtree prefix="${prefix}"
}

pbuild::post_install() {
        make install-doc V=1 XMLTO_EXTRA='--skip-validation'
	make -C contrib/subtree prefix="${PREFIX}" install
	make -C contrib/subtree prefix="${PREFIX}" install-doc XMLTO="xmlto --skip-validation"
}

# Local Variables:
# mode: sh
# sh-basic-offset: 8
# tab-width: 8
# End:
