#!/usr/bin/env modbuild

# :FIXME: download url must be added and script must be reviewed!

#pbuild::supported_os 'Linux'

case $OS in 
	Linux )
		target='LINUX-X86_64-PMODULE'
		;;
	Darwin )
		target='MACOSX-GFORTRAN-INTEL-MPI'
		;;
esac

pbuild::configure() {
	cp -v "${BUILDBLOCK_DIR}/${target}" "${BUILD_DIR}/configure"
	./configure.sh "${target}" || exit 1
}

pbuild::compile() {
	make
}

pbuild::install() {
	mkdir -p "${PREFIX}/bin"
	cp "${SRC_DIR}/bin/cpmd.x" "${PREFIX}/bin"
}

pbuild::add_to_group 'MPI'
pbuild::set_runtime_dependencies "${COMPILER}" "${MPI}"
pbuild::set_build_dependencies "${COMPILER}" "${MPI}"
pbuild::compile_in_sourcetree
pbuild::make_all

