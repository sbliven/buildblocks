#!/usr/bin/env modbuild

# get mappings for our version numbers to the published tarfile names
TARNAME=$(grep -E "^${V_MAJOR}.${V_MINOR}" files/version-to-tarname.txt| awk '{print $2}')

# pbuild::set_download_url "https://gitlab.psi.ch/caubet_m/merlin-software/raw/master/$P/$P-${V_PKG}.tar.gz"
# pbuild::set_download_url "https://github.com/lammps/lammps/archive/${TARNAME}"
pbuild::set_download_url "https://lammps.sandia.gov/tars/${TARNAME}"

pbuild::add_to_group 'MPI'

pbuild::install_docfiles README LICENSE

pbuild::configure() {
	cmake -D CMAKE_INSTALL_PREFIX="${PREFIX}" \
              -D CMAKE_BUILD_TYPE=RELEASE \
              -D BUILD_MPI=yes \
              -D BUILD_OMP=yes \
              -D BUILD_TOOLS=yes \
              -D BUILD_DOC=yes \
              -D LAMMPS_MACHINE=mpi \
              -D PKG_USER-OMP=yes \
              -D PKG_ASPHERE=yes \
              -D PKG_BODY=yes \
              -D PKG_COMPRESS=yes \
              -D PKG_CORESHELL=yes \
              -D PKG_DIPOLE=yes \
              -D PKG_GRANULAR=yes \
              -D PKG_MANYBODY=yes \
              -D PKG_KSPACE=yes \
              -D PKG_MC=yes \
              -D PKG_MISC=yes \
              -D PKG_MOLECULE=yes \
              -D PKG_MPIIO=yes \
              -D PKG_OPT=yes \
              -D PKG_PYTHON=yes \
              -D PKG_REPLICA=yes \
              -D PKG_RIGID=yes \
              -D PKG_SNAP=yes \
              -D PKG_USER-EFF=yes \
              -D PKG_USER-DRUDE=yes \
              -D PKG_USER-REAXC=yes \
              -D BUILD_SHARED_LIBS=on \
	      ${BUILD_DIR}/../src/cmake
}

pbuild::compile() {
	cmake --build ${BUILD_DIR}
}

pbuild::install() {
        make install
}
