#%Module1.0

module-whatis	        "3D reconstructions or 2D class averages in electron cryo-microscopy (cryo-EM)"
module-url		"https://www2.mrc-lmb.cam.ac.uk/relion/index.php/Main_Page"
module-license	        "GPLv2 license"
module-maintainer	"Greta Assmann <greta.assmann@psi.ch>"

module-help	"
RELION (for REgularised LIkelihood OptimisatioN, pronounce rely-on) is a
stand-alone computer program that employs an empirical Bayesian approach to
refinement of (multiple) 3D reconstructions or 2D class averages in electron
cryo-microscopy (cryo-EM). It is developed in the group of Sjors Scheres at the
MRC Laboratory of Molecular Biology. Briefly, the ill-posed problem of
3D-reconstruction is regularised by incorporating prior knowledge: the fact
that macromolecular structures are smooth, i.e. they have limited power in the
Fourier domain. In the corresponding Bayesian framework, many parameters of a
statistical model are learned from the data, which leads to objective and
high-quality results without the need for user expertise. The underlying theory
is given in Scheres (2012) JMB. A more detailed description of its
implementation is given in Scheres (2012) JSB. If RELION is useful in your
work, please cite at least one of these papers. 

Scheres(2012) JMB http://www.sciencedirect.com/science/article/pii/S0022283611012290
Scheres(2012) JSB http://www.sciencedirect.com/science/article/pii/S1047847712002481
"

setenv RELION_QUEUE_USE yes
setenv RELION_QUEUE_NAME general-x64
setenv RELION_QSUB_COMMAND sbatch
setenv RELION_THREAD_MAX 44
setenv RELION_QSUB_EXTRA_COUNT 4
setenv RELION_QSUB_EXTRA1 "Max Time"
setenv RELION_QSUB_EXTRA1_DEFAULT "1-00:00:00"
setenv RELION_QSUB_EXTRA1_HELP "Maximum time before the job is killed by slurm. Default: 1-00:00:00"
setenv RELION_QSUB_EXTRA2 "Extra Slurm Args"
setenv RELION_QSUB_EXTRA2_DEFAULT ""
setenv RELION_QSUB_EXTRA2_HELP "Any additional arguments to pass to slurm"
setenv RELION_SCRATCH_DIR /scratch
setenv RELION_CTFFIND_EXECUTABLE /opt/psi/EM/ctffind4/4.1.8/bin/ctffind
#also has internal version, depending on what users want... dont know if it works
setenv RELION_RESMAP_EXECUTABLE /opt/psi/EM/ResMap/1.1.4/bin/ResMap
# Version-specific variables
setenv RELION_QSUB_TEMPLATE /opt/psi/overlays/Alps/EM/relion/$V/scripts/multi_gpu.sh

setenv RELION_MOTIONCOR2_EXECUTABLE "/opt/psi/EM/MotionCor2/1.6.4/bin/MotionCor2"

setenv RELION_TOPAZ_EXECUTABLE /opt/psi/overlays/Alps/EM/relion/$V/miniconda/envs/relion-5.0/bin/topaz
setenv RELION_PYTHON_EXECUTABLE /opt/psi/overlays/Alps/EM/relion/$V/miniconda/envs/relion-5.0/bin/python
setenv RELION_TORCH_HOME_PATH /opt/psi/overlays/Alps/EM/relion/$V/torch/

