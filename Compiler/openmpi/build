#!/usr/bin/env modbuild

pbuild::set_download_url \
	"http://www.open-mpi.org/software/ompi/v${V_MAJOR}.${V_MINOR}/downloads/openmpi-$V.tar.bz2" \
	'c654ed847f34a278c52a15c98add40402b4a90f0c540779f1ae6c489af8a76c5'

pbuild::configure() {
	declare -a config_args=()
	if [[ -n "${CUDA_VERSION}" ]]; then	
		config_args+=( "--with-cuda=${CUDA_HOME}" )
	fi

	"${SRC_DIR}"/configure \
		--prefix="${PREFIX}" \
		--enable-mpi-cxx \
		--enable-mpi-cxx-seek \
		--enable-mpi-f90 \
		--enable-mpi-profile \
		--enable-orterun-prefix-by-default \
		--enable-shared \
		--enable-static \
		--enable-smp-locks \
		--with-sge=yes \
		--with-slurm=yes \
		"${config_args[@]}" \
		|| exit 1
}

pbuild::post_install() {
	if [[ -r /usr/lib64/libnuma.a ]]; then
		:
	fi
}

pbuild::add_to_group 'Compiler'
pbuild::install_docfiles 'AUTHORS' 'LICENSE' 'NEWS' 'README'
pbuild::make_all
