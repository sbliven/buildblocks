#!/usr/bin/env modbuild

SOURCE_URL="http://www.open-mpi.org/software/ompi/v${V_MAJOR}.${V_MINOR}/downloads/openmpi-$V.tar.bz2"

pbuild::configure() {
	declare -a config_args=()
	if [[ -n "${CUDA_VERSION}" ]]; then	
		config_args+=( "--with-cuda=${CUDA_HOME}" )
	fi

	"${MODULE_SRCDIR}"/configure \
		--prefix="${PREFIX}" \
		--enable-mpi-cxx \
		--enable-mpi-cxx-seek \
		--enable-mpi-f90 \
		--enable-mpi-profile \
		--enable-orterun-prefix-by-default \
		--enable-shared \
		--enable-static \
		--enable-smp-locks \
		--with-sge=yes \
		--with-slurm=yes \
		"${config_args[@]}" \
		|| exit 1
}

pbuild::post_install() {
	if [[ -r /usr/lib64/libnuma.a ]]; then
		:
	fi
}

pbuild::add_to_group 'Compiler'
pbuild::set_docfiles 'AUTHORS' 'LICENSE' 'NEWS' 'README'
pbuild::make_all
